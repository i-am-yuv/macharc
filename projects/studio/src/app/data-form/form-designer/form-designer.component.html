<vezo-toast></vezo-toast>
<div class="">
  <!-- top bar with microservie, screen , Save and Back button -->
  <div class="flex">
    <div class="w-[240px] border-r" *ngIf="this.currListView">
      <div class="p-4 w-full border-b">List of Components</div>
      <div class="flex place-items-center gap-2 py-3 w-full border-b">
        <div class="w-full col-span-2">
          <div
            class="flex place-items-center px-4 cursor-pointer"
            (click)="addData()"
          >
            <img src="assets/icons8_plus.png" class="mr-2 w-5" />
            <div style="font-size: 14px; font-weight: 400; color: #6d6d6d">
              New Component
            </div>
          </div>
        </div>
      </div>

      <!-- All Component list Left side bar -->
      <div class="">
        <div *ngFor="let item of getDataSorted()">
          <div
            class="px-4 cursor-pointer border-b"
            [ngClass]="{ 'bg-slate-50': this.formId == item.id }"
            (mouseenter)="hoverComp('enter', item)"
            (mouseleave)="hoverComp('exit', item)"
          >
            <div class="flex justify-between items-center">
              <div (click)="openNewComponent(item)" class="my-2">
                {{ item.formName }}
              </div>
              <div
                *ngIf="this.currentComponent?.id == item.id"
                class="flex gap-2 justify-end px-1"
              >
                <!-- <img  src="assets/open_with.svg" style="width: 12px; height:auto" /> -->
                <vezo-icon
                  icon="pencil"
                  (click)="editData(item)"
                  className=" w-3 h-3 text-indigo-500 cursor-pointer"
                ></vezo-icon>
                <vezo-icon
                  icon="documentDuplicate"
                  (click)="duplicateData(item)"
                  className="w-3 h-3 text-indigo-500 cursor-pointer"
                ></vezo-icon>
                <vezo-icon
                  icon="trash"
                  (click)="confirmToDelete(item)"
                  className="w-3 h-3 text-red-500 cursor-pointer"
                ></vezo-icon>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="grow">
      <!-- top bar with the resize screen tab -->

      <div class="flex gap-2 w-full bg-gray-100 pt-3 pb-4 px-4">
        <div class="w-1/3 flex">
          <div class="cursor-pointer">
            <div
              class="flex place-items-center cursor-pointer col-span-1"
              [routerLink]="'/applications'"
            >
              <vezo-icon
                icon="chevronLeft"
                className="w-4 h-4 mx-2"
              ></vezo-icon>
              <div class="">Back</div>
            </div>
          </div>
        </div>
        <div class="w-1/3">
          <div
            class="flex gap-4"
            style="justify-content: center; align-items: center"
          >
            <img
              src="assets/refresh-ccw.png"
              class=""
              style="width: 16px; height: 16px"
              class="cursor-pointer"
              (click)="resetZoom()"
            />

            <div
              class="flex justify-center items-center gap-1"
              [ngStyle]="{ 'background-color': getBackgroundColor() }"
            >
              <div>
                <!-- Choosed Screen -->
                <div *ngIf="this.mutiScreenView == false">
                  <img
                    src="{{ this.currentScreenView }}"
                    style="width: 25px; cursor: pointer"
                    (click)="mutiScreenView = !mutiScreenView"
                  />
                </div>

                <!-- Screen to Choose from -->
                <div
                  *ngIf="this.mutiScreenView == true"
                  class="flex gap-3 px-2"
                >
                  <div
                    (click)="
                      changeScreen('assets/circum_mobile-1.png', 'mobile')
                    "
                    class="cursor-pointer"
                  >
                    <img
                      src="assets/circum_mobile-1.png"
                      style="height: 16px; width: 16px"
                    />
                  </div>
                  <div
                    (click)="
                      changeScreen(
                        'assets/material-symbols-light_tablet-android-outline.svg',
                        'tablet'
                      )
                    "
                    class="cursor-pointer"
                  >
                    <img
                      src="assets/material-symbols-light_tablet-android-outline.svg"
                      style="width: 18px"
                    />
                  </div>
                  <div
                    (click)="
                      changeScreen('assets/monitor-smartphone.svg', 'desktop')
                    "
                    class="cursor-pointer"
                  >
                    <img
                      src="assets/monitor-smartphone.svg"
                      style="width: 16px"
                    />
                  </div>
                </div>
              </div>
              <div
                (click)="mutiScreenView = !mutiScreenView"
                class="cursor-pointer"
              >
                <img src="assets/elementsClose.svg" style="width: 12px" />
              </div>
            </div>
            <!-- <div>{{this.childWidth}}px</div> -->
            <div
              class="flex justify-start gap-1 px-2"
              style="
                border-width: 1px;
                border-color: #ffffff;
                border-radius: 4px;
              "
            >
              <input [(ngModel)]="this.childWidth" style="width: 45px" />
              <span> px</span>
            </div>
          </div>
        </div>
        <div class="w-1/3">
          <div class="flex w-full justify-end gap-4">
            <!-- <img
                src="assets/iconamoon_edit-thin.png"
                style="width: 18px; height: 18px"
              /> -->
            <img
              src="assets/rotate-ccw.png"
              style="width: 18px; height: 18px"
            />
            <img src="assets/rotate-cw.png" style="width: 18px; height: 18px" />
          </div>
          <!-- <div class="flex-1 gap-2 flex justify-center items-center">
                            <div style="font-size: 14px; font-weight: 400; color: #6D6D6D;">Preview</div>
                            <img src="assets/elementsClose.svg" style="width: 12px ;">
                        </div> -->
          <!-- <div class="flex-1 gap-2 flex justify-center items-center">
                            <div style="font-size: 14px; font-weight: 400; color: #6D6D6D;">Deploy</div>
                            <img src="assets/elementsClose.svg" style="width: 12px ;">
                        </div> -->
        </div>
      </div>

      <div
        class="flex justify-center items-center border-b"
        style="background-color: #eef2ff"
      >
        <div *ngIf="this.formId !== null" class="w-full flex p-2">
          <div class="flex-none w-4/5 flex justify-center items-center">
            <div class="flex justify-center items-center w-full">
              <div class="flex w-full">
                <div class="flex-none w-2/5">
                  <div
                    class="text-center"
                    style="color: #4038ca; font-size: 13px; font-weight: 400"
                  >
                    MICROSERVICES:
                    <span>{{
                      formData.collection?.microService?.microServiceName
                        | uppercase
                    }}</span>
                  </div>
                </div>
                <div class="flex-none w-2/5 flex justify-center items-center">
                  <div
                    class="text-center"
                    style="color: #4038ca; font-size: 13px; font-weight: 400"
                  >
                    Component:
                    <span>{{ formData.formName | uppercase }}</span>
                  </div>
                </div>
                <div
                  class="flex-none w-1/5 flex justify-center items-center"
                ></div>
              </div>
            </div>
          </div>
          <div class="flex-none w-1/5 flex justify-end items-center pr-4 gap-8">
            <div class="flex cursor-pointer" (click)="saveDefinition()">
              <vezo-icon
                icon="inbox"
                className="w-3 h-3 mr-2"
                style="color: #4038ca"
              ></vezo-icon>
              <span
                class=""
                style="color: #4038ca; font-size: 13px; font-weight: 400"
                >Save</span
              >
            </div>
            <!-- <div class="cursor-pointer flex" routerLink="../../">
                                <vezo-icon icon="arrowUturnLeft" className="w-3 h-3 mr-2"
                                    style="color: #4038CA;"></vezo-icon>
                                <span class="" style="color: #4038CA; font-size: 13px;font-weight: 400;">Back</span>
                            </div> -->
          </div>
        </div>
      </div>
      <!-- Component Display content and style part -->
      <div *ngIf="this.formId != null" class="flex w-full">
        <div class="grow">
          <div class="flex border-b">
            <!-- Left panel toggle -->
            <div class="cursor-pointer p-2 px-4 border-r">
              <svg
                *ngIf="currListView == true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.25"
                stroke-linecap="round"
                stroke-linejoin="round"
                className="cursor-pointer w-5 h-5"
                style="color: black"
                (click)="currListView = false"
              >
                <path d="m9 6-6 6 6 6" />
                <path d="M3 12h14" />
                <path d="M21 19V5" />
              </svg>
              <svg
                *ngIf="currListView == false"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.25"
                stroke-linecap="round"
                stroke-linejoin="round"
                className=" w-5 h-5"
                style="color: black"
                (click)="currListView = true"
              >
                <path d="M3 5v14" />
                <path d="M21 12H7" />
                <path d="m15 18 6-6-6-6" />
              </svg>
            </div>
            <!-- Zoom in and out Code -->
            <div class="flex justify-start items-center gap-4 w-full px-4">
              <div class="flex gap-2 justify-center items-center">
                <button (click)="zoomIn()">
                  <img
                    src="assets/add_circle_outline.svg"
                    style="height: 24px; width: 24px"
                  />
                </button>
                <button (click)="zoomOut()">
                  <img
                    src="assets/remove_circle_outline.svg"
                    style="height: 24px; width: 24px"
                  />
                </button>
              </div>
              <div>Zoom: {{ zoom * 100 | number: "1.2-2" }}%</div>
            </div>
            <!-- Right panel toggle -->
            <div
              class="cursor-pointer p-2 px-4 border-l"
              (click)="rightPanelExpanded = !rightPanelExpanded"
            >
              <svg
                *ngIf="rightPanelExpanded == false"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.25"
                stroke-linecap="round"
                stroke-linejoin="round"
                className="cursor-pointer w-5 h-5"
                style="color: black"
              >
                <path d="m9 6-6 6 6 6" />
                <path d="M3 12h14" />
                <path d="M21 19V5" />
              </svg>
              <svg
                *ngIf="rightPanelExpanded == true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.25"
                stroke-linecap="round"
                stroke-linejoin="round"
                className=" w-5 h-5"
                style="color: black"
              >
                <path d="M3 5v14" />
                <path d="M21 12H7" />
                <path d="m15 18 6-6-6-6" />
              </svg>
            </div>
          </div>

          <!-- DND ZONE -->
          <div class="dndWrapper bg-gray-50" #dndContainer>
            <div class="dndScroll" #dndList>
              <div
                [class.horizontal]="layout.dndHorizontal"
                [dndHorizontal]="layout.dndHorizontal"
                (dndDrop)="onDrop($event, draggableListRight)"
                class="m-8 bg-white dndList name border-2 border-dotted h-full border-cyan-600"
                dndDropzone
                dndEffectAllowed="copyMove"
                [ngStyle]="childStyles"
              >
                <div
                  class="dndPlaceholder h-16 border bg-blue-400 bg-opacity-25"
                  dndPlaceholderRef
                ></div>
                <div
                  *ngFor="let item of draggableListRight"
                  [dndDraggable]="item"
                  (click)="handleClick($event, item)"
                  (dndCanceled)="onDragged(item, draggableListRight, 'none')"
                  (dndCopied)="onDragged(item, draggableListRight, 'move')"
                  (dndLinked)="onDragged(item, draggableListRight, 'link')"
                  (dndMoved)="onDragged(item, draggableListRight, 'move')"
                >
                  <div
                    class="draggable-item border border-dashed border-indigo-300 cursor-pointer relative overflow-x: auto;"
                  >
                    <ng-container *ngIf="item.name === 'grid'">
                      <div
                        (dndDrop)="onDrop($event, item.children)"
                        class="name gap-{{ item.data.gap }} grid grid-cols-{{
                          item.data.columns
                        }}
                        justify-{{ item.data.alignment }} items-{{
                          item.data.vAlignment
                        }}"
                        [ngClass]="{
                          'p-8':
                            !this.item.children ||
                            this.item.children.length === 0
                        }"
                        [ngStyle]="{
                          'margin-top': item.data?.mt + 'px',
                          'margin-bottom': item.data?.mb + 'px',
                          'margin-left': item.data?.ml + 'px',
                          'margin-right': item.data?.mr + 'px',
                          'padding-top':
                            (item.children && item.children.length > 0
                              ? item.data?.pt
                              : 32) + 'px',
                          'padding-bottom':
                            (item.children && item.children.length > 0
                              ? item.data?.pb
                              : 32) + 'px',
                          'padding-left':
                            (item.children && item.children.length > 0
                              ? item.data?.pl
                              : 32) + 'px',
                          'padding-right':
                            (item.children && item.children.length > 0
                              ? item.data?.pr
                              : 32) + 'px'
                        }"
                        dndDropzone
                        dndEffectAllowed="copyMove"
                      >
                        <div
                          class="dndPlaceholder h-16 border bg-blue-400 bg-opacity-25"
                          dndPlaceholderRef
                        ></div>
                        <div
                          *ngFor="let child of item.children"
                          [dndDraggable]="child"
                          (dndCanceled)="
                            onDragged(child, item.children!, 'none')
                          "
                          (dndCopied)="onDragged(child, item.children!, 'move')"
                          (dndLinked)="onDragged(child, item.children!, 'link')"
                          (dndMoved)="onDragged(child, item.children!, 'move')"
                          class="name"
                        >
                          <div class="border border-dashed border-indigo-300">
                            <!-- This line was not working in the case of nested grid -->
                            <!-- <app-blocks [block]="child" (click)="handleClick($event, child)"></app-blocks> -->

                            <!-- Solution for nested grid -->
                            <ng-container *ngIf="child.name === 'container'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'container'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'row'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'row'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'grid'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'grid'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'column'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'column'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container
                              *ngIf="
                                child.name !== 'row' &&
                                child.name !== 'container' &&
                                child.name !== 'grid' &&
                                child.name !== 'column'
                              "
                            >
                              <app-blocks
                                [block]="child"
                                (click)="handleClick($event, child)"
                              ></app-blocks>
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </ng-container>

                    <ng-container *ngIf="item.name === 'container'">
                      <div
                        (dndDrop)="onDrop($event, item.children)"
                        class="name gap-{{ item.data.gap }} grid grid-cols-{{
                          item.data.columns
                        }}  items-{{ item.data.vAlignment }} shadow-{{
                          item.data.shadow
                        }}"
                        [ngStyle]="{
                          width: item.data?.width
                            ? item.data?.width + 'px'
                            : 'auto',
                          height: item.data?.height
                            ? item.data?.height + 'px'
                            : 'auto',
                          'background-color':
                            item.mappedData?.bgColor == null
                              ? item.data?.bgColor
                              : item.mappedData?.bgColor,
                          'background-image':
                            'url(' +
                            (item.mappedData?.bgImage == null
                              ? item.data?.bgImage
                              : item.mappedData?.bgImage) +
                            ')',
                          'background-size': 'cover',
                          'background-position': 'center',
                          'border-width': item.data.borderWidth + 'px',
                          'border-radius': item.data.borderRadius + 'px',
                          'border-color':
                            item.mappedData?.borderColor == null
                              ? item.data?.borderColor
                              : item.mappedData?.borderColor,
                          'justify-items': item.data.alignment,
                          'margin-top': item.data?.mt + 'px',
                          'margin-bottom': item.data?.mb + 'px',
                          'margin-left': item.data?.ml + 'px',
                          'margin-right': item.data?.mr + 'px',
                          'padding-top': item.data?.pt + 'px',
                          'padding-bottom': item.data?.pb + 'px',
                          'padding-left': item.data?.pl + 'px',
                          'padding-right': item.data?.pr + 'px'
                        }"
                        [ngClass]="{
                          'p-8':
                            !this.item.children ||
                            this.item.children.length === 0
                        }"
                        dndDropzone
                        dndEffectAllowed="copyMove"
                      >
                        <div
                          class="dndPlaceholder h-16 border bg-blue-400 bg-opacity-25"
                          dndPlaceholderRef
                        ></div>
                        <div
                          *ngFor="let child of item.children"
                          [dndDraggable]="child"
                          (dndCanceled)="
                            onDragged(child, item.children!, 'none')
                          "
                          (dndCopied)="onDragged(child, item.children!, 'move')"
                          (dndLinked)="onDragged(child, item.children!, 'link')"
                          (dndMoved)="onDragged(child, item.children!, 'move')"
                          [ngClass]="{ expand: child.name == 'row' }"
                        >
                          <div class="border border-dashed border-indigo-300">
                            <!-- Because This line was not working in the case of nested grid -->
                            <!-- <app-blocks [block]="child" (click)="handleClick($event, child)"></app-blocks> -->

                            <!-- Solution for nested grid -->
                            <ng-container *ngIf="child.name === 'container'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'container'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'row'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'row'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'column'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'column'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'grid'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'grid'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container
                              *ngIf="
                                child.name !== 'row' &&
                                child.name !== 'container' &&
                                child.name !== 'grid' &&
                                child.name !== 'column'
                              "
                            >
                              <app-blocks
                                [block]="child"
                                (click)="handleClick($event, child)"
                              ></app-blocks>
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </ng-container>

                    <ng-container *ngIf="item.name === 'row'">
                      <div
                        (dndDrop)="onDrop($event, item.children)"
                        class="name gap-{{ item.data.gap }} flex  items-{{
                          item.data.vAlignment
                        }}"
                        [ngClass]="{
                          'p-8':
                            !this.item.children ||
                            this.item.children.length === 0
                        }"
                        [ngStyle]="{
                          'margin-top': item.data.mt + 'px',
                          'margin-bottom': item.data.mb + 'px',
                          'margin-left': item.data.ml + 'px',
                          'margin-right': item.data.mr + 'px',
                          'padding-top':
                            (item.children && item.children.length > 0
                              ? item.data?.pt
                              : 32) + 'px',
                          'padding-bottom':
                            (item.children && item.children.length > 0
                              ? item.data?.pb
                              : 32) + 'px',
                          'padding-left':
                            (item.children && item.children.length > 0
                              ? item.data?.pl
                              : 32) + 'px',
                          'padding-right':
                            (item.children && item.children.length > 0
                              ? item.data?.pr
                              : 32) + 'px',
                          'justify-content': item.data.alignment
                        }"
                        dndDropzone
                        dndEffectAllowed="copyMove"
                      >
                        <div
                          class="dndPlaceholder h-16 border bg-blue-400 bg-opacity-25"
                          dndPlaceholderRef
                        ></div>
                        <div
                          *ngFor="let child of item.children"
                          [dndDraggable]="child"
                          (dndCanceled)="
                            onDragged(child, item.children!, 'none')
                          "
                          (dndCopied)="onDragged(child, item.children!, 'move')"
                          (dndLinked)="onDragged(child, item.children!, 'link')"
                          (dndMoved)="onDragged(child, item.children!, 'move')"
                          class="name"
                          style="width: -webkit-fill-available"
                        >
                          <div class="border-dashed border border-indigo-300">
                            <!-- Solution for nested grid -->
                            <ng-container *ngIf="child.name === 'container'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'container'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'row'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'row'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'column'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'column'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'grid'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'grid'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container
                              *ngIf="
                                child.name !== 'row' &&
                                child.name !== 'container' &&
                                child.name !== 'grid' &&
                                child.name !== 'column'
                              "
                            >
                              <app-blocks
                                [block]="child"
                                (click)="handleClick($event, child)"
                              ></app-blocks>
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </ng-container>

                    <ng-container *ngIf="item.name === 'column'">
                      <div
                        (dndDrop)="onDrop($event, item.children)"
                        class="name  gap-{{
                          item.data.gap
                        }} flex flex-col justify-{{
                          item.data.alignment
                        }} items-{{ item.data.vAlignment }}"
                        [ngClass]="{
                          'p-8':
                            !this.item.children ||
                            this.item.children.length === 0
                        }"
                        [ngStyle]="{
                          'margin-top': item.data.mt + 'px',
                          'margin-bottom': item.data.mb + 'px',
                          'margin-left': item.data.ml + 'px',
                          'margin-right': item.data.mr + 'px',
                          'padding-top':
                            (item.children && item.children.length > 0
                              ? item.data?.pt
                              : 32) + 'px',
                          'padding-bottom':
                            (item.children && item.children.length > 0
                              ? item.data?.pb
                              : 32) + 'px',
                          'padding-left':
                            (item.children && item.children.length > 0
                              ? item.data?.pl
                              : 32) + 'px',
                          'padding-right':
                            (item.children && item.children.length > 0
                              ? item.data?.pr
                              : 32) + 'px'
                        }"
                        dndDropzone
                        dndEffectAllowed="copyMove"
                      >
                        <div
                          class="dndPlaceholder h-16 border bg-blue-400 bg-opacity-25"
                          dndPlaceholderRef
                        ></div>
                        <div
                          *ngFor="let child of item.children"
                          [dndDraggable]="child"
                          (dndCanceled)="
                            onDragged(child, item.children!, 'none')
                          "
                          (dndCopied)="onDragged(child, item.children!, 'move')"
                          (dndLinked)="onDragged(child, item.children!, 'link')"
                          (dndMoved)="onDragged(child, item.children!, 'move')"
                          [ngClass]="{ expand: child.name == 'container' }"
                        >
                          <div class="border border-dashed border-indigo-300">
                            <!-- Solution for nested grid -->
                            <ng-container *ngIf="child.name === 'column'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'column'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'container'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'container'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'row'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'row'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container *ngIf="child.name === 'grid'">
                              <app-nested
                                [child]="child"
                                [layout]="layout"
                                [nestedElement]="'grid'"
                                (nodeClicked)="onItemReceived($event)"
                              ></app-nested>
                            </ng-container>
                            <ng-container
                              *ngIf="
                                child.name !== 'row' &&
                                child.name !== 'container' &&
                                child.name !== 'grid' &&
                                child.name !== 'column'
                              "
                            >
                              <app-blocks
                                [block]="child"
                                (click)="handleClick($event, child)"
                              ></app-blocks>
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </ng-container>

                    <div class="relative-container">
                      <div
                        class="trash-icon"
                        *ngIf="this.activeItem?.id === item?.id"
                      >
                        <vezo-icon
                          icon="trash"
                          class="mr-2 text-red-500 cursor-pointer"
                          className="w-4 h-4"
                          (click)="deleteActiveItem(true)"
                        ></vezo-icon>
                      </div>
                      <app-blocks
                        [block]="item"
                        (click)="handleClick($event, item)"
                        class="block-content"
                      ></app-blocks>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- right panel-->
        <div *ngIf="this.rightPanelExpanded" class="w-[340px]">
          <div class="w-full border-l border-b">
            <div class="bg-white">
              <div class="flex w-full">
                <div
                  class="w-6/12 p-3 cursor-pointer"
                  [style.background-color]="
                    this.activeItem?.id === null ? '#4038CA' : '#C7D2FE'
                  "
                  (click)="onClickPickElement()"
                >
                  <div class="flex justify-between gap-3">
                    <div>
                      <span
                        *ngIf="!showProps"
                        [style.color]="
                          this.activeItem?.id === null ? '#F6F6F6' : '#454545'
                        "
                        style="font-size: 12px; font-weight: 500"
                        >PICK AN ELEMENT</span
                      >
                      <span
                        *ngIf="showProps"
                        [style.color]="
                          this.activeItem?.id === null ? '#F6F6F6' : '#454545'
                        "
                        style="font-size: 12px; font-weight: 500"
                        >Widgets</span
                      >
                    </div>
                    <div
                      class="bg-slate-200 rounded-full flex justify-center items-center w-6 h-6"
                    >
                      <!-- <vezo-icon icon="bars2" *ngIf="!showProps" className="cursor-pointer w-4 h-4"
                                            (click)="showProps=!showProps" style="color:white"></vezo-icon>
                                        <vezo-icon icon="squares2x2" *ngIf="showProps"
                                            className="cursor-pointer w-4 h-4" style="color:white"
                                            (click)="showProps=!showProps"></vezo-icon> -->
                      <img
                        *ngIf="!showProps"
                        src="assets/switch_left.svg"
                        class="w-4 h-4"
                        (click)="showProps = !showProps"
                      />
                      <img
                        *ngIf="showProps"
                        src="assets/switch_right.svg"
                        class="w-4 h-4"
                        (click)="showProps = !showProps"
                      />
                    </div>
                  </div>
                </div>

                <div
                  class="w-6/12 p-3 justify-center"
                  [style.background-color]="
                    this.activeItem?.id !== null ? '#4038CA' : '#C7D2FE'
                  "
                >
                  <div
                    [style.color]="
                      this.activeItem?.id !== null ? '#F6F6F6' : '#454545'
                    "
                    style="
                      font-size: 12px;
                      font-weight: 500;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                    "
                  >
                    STYLES
                  </div>
                </div>
              </div>
              <!-- All elements -->
              <div *ngIf="this.activeItem?.id == null" class="overflow-auto">
                <div *ngIf="!showProps">
                  <div class="m-3 bg-white">
                    <vezo-searchfield
                      type="text"
                      placeholder="Search"
                      (valueChange)="onSearchValueChange($event)"
                    ></vezo-searchfield>
                  </div>
                  <!-- Virtual Elements -->
                  <div
                    class="m-3 flex gap-2 justify-start align-middle"
                    style="align-items: center"
                  >
                    <div
                      *ngIf="virtualElementsExpand"
                      class="cursor-pointer"
                      (click)="virtualElementsExpand = !virtualElementsExpand"
                    >
                      <img src="assets/elementsClose.svg" />
                    </div>
                    <div
                      *ngIf="!virtualElementsExpand"
                      class="cursor-pointer"
                      (click)="virtualElementsExpand = !virtualElementsExpand"
                    >
                      <img
                        *ngIf="this.isExpanded == false"
                        src="assets/Polygon 5.svg"
                        style="width: 7px; height: 14px"
                      />
                    </div>
                    <div
                      style="font-size: 16px; font-weight: 600; color: black"
                    >
                      Visual Elements
                    </div>
                  </div>
                  <div
                    *ngIf="virtualElementsExpand"
                    class="dndList px-3 py-1 name"
                  >
                    <div class="grid grid-cols-2 gap-2">
                      <div
                        *ngFor="
                          let item of getList(
                            draggableListLeftVE,
                            filteredDraggableListLeftVE
                          )
                        "
                        [dndDraggable]="item"
                        [dndEffectAllowed]="item.effectAllowed"
                        class="cursor-move"
                      >
                        <div
                          class="draggable-item mb-2 border bg-white shadow-sm"
                          style="border-radius: 4px"
                        >
                          <div
                            class="flex gap-3 py-2 px-2"
                            style="justify-content: start; align-items: center"
                          >
                            <div class="col-2">
                              <img [src]="item.icon" />
                            </div>
                            <div class="col-10">
                              {{ item.name | capitalize }}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Layout Elements -->
                  <div
                    class="m-3 flex gap-2 justify-start align-middle"
                    style="align-items: center"
                  >
                    <div
                      *ngIf="layoutElementsExpand"
                      class="cursor-pointer"
                      (click)="layoutElementsExpand = !layoutElementsExpand"
                    >
                      <img src="assets/elementsClose.svg" />
                    </div>
                    <div
                      *ngIf="!layoutElementsExpand"
                      class="cursor-pointer"
                      (click)="layoutElementsExpand = !layoutElementsExpand"
                    >
                      <img
                        *ngIf="this.isExpanded == false"
                        src="assets/Polygon 5.svg"
                        style="width: 7px; height: 14px"
                      />
                    </div>
                    <div
                      style="font-size: 16px; font-weight: 600; color: black"
                    >
                      Layout Elements
                    </div>
                  </div>
                  <div
                    *ngIf="layoutElementsExpand"
                    class="dndList px-3 py-1 name"
                  >
                    <div class="grid grid-cols-2 gap-2">
                      <div
                        *ngFor="
                          let item of getList(
                            draggableListLeftLE,
                            filteredDraggableListLeftLE
                          )
                        "
                        [dndDraggable]="item"
                        [dndEffectAllowed]="item.effectAllowed"
                        class="cursor-move"
                      >
                        <div
                          class="draggable-item mb-2 border bg-white shadow-sm"
                          style="border-radius: 4px"
                        >
                          <div
                            class="flex gap-3 py-2 px-2"
                            style="justify-content: start; align-items: center"
                          >
                            <div class="col-2">
                              <img [src]="item.icon" />
                            </div>
                            <div class="col-10">{{ item.content }}</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Page Elements -->
                  <div
                    class="m-3 flex gap-2 justify-start align-middle"
                    style="align-items: center"
                  >
                    <div
                      *ngIf="pageElementsExpand"
                      class="cursor-pointer"
                      (click)="pageElementsExpand = !pageElementsExpand"
                    >
                      <img src="assets/elementsClose.svg" />
                    </div>
                    <div
                      *ngIf="!pageElementsExpand"
                      class="cursor-pointer"
                      (click)="pageElementsExpand = !pageElementsExpand"
                    >
                      <img
                        *ngIf="this.isExpanded == false"
                        src="assets/Polygon 5.svg"
                        style="width: 7px; height: 14px"
                      />
                    </div>
                    <div
                      style="font-size: 16px; font-weight: 600; color: black"
                    >
                      Page Elements
                    </div>
                  </div>
                  <div
                    *ngIf="pageElementsExpand"
                    class="dndList px-3 py-1 name"
                  >
                    <div class="grid grid-cols-2 gap-2">
                      <div
                        *ngFor="
                          let item of getList(
                            draggableListLeftPE,
                            filteredDraggableListLeftPE
                          )
                        "
                        [dndDraggable]="item"
                        [dndEffectAllowed]="item.effectAllowed"
                        class="cursor-move"
                      >
                        <div
                          class="draggable-item mb-2 border bg-white shadow-sm"
                          style="border-radius: 4px"
                        >
                          <div
                            class="flex gap-3 py-2 px-2"
                            style="justify-content: start; align-items: center"
                          >
                            <div class="col-2">
                              <img [src]="item.icon" />
                            </div>
                            <div class="col-10">{{ item.content }}</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Widget Tree Code -->
                <div *ngIf="showProps" class="p-2 bg-gray-100">
                  <!-- Copy the complete component -->
                  <div *ngIf="widgetTree.length !== 0" class="flex justify-end">
                    <!-- <div style="font-size: 14px; font-weight: 500; color:#2e2e2e">Copy Component</div> -->
                    <img
                      src="assets/copy-clipboard.svg"
                      (click)="copyThisComponent(this.draggableListRight)"
                      style="width: 20px; height: 20px; cursor: pointer"
                    />
                    <div
                      style="font-size: 12px"
                      class="ml-1 cursor-pointer"
                      (click)="copyThisComponent(this.draggableListRight)"
                    >
                      Copy All
                    </div>
                  </div>
                  <!-- widget Tree Content-->
                  <div style="display: flex; flex-direction: column">
                    <div *ngFor="let item of widgetTree">
                      <app-widget-tree-node
                        [node]="item"
                        (nodeClicked)="onItemReceived($event)"
                        (copyClicked)="onItemReceivedCopy($event)"
                        (pasteClicked)="onItemReceivedPaste($event)"
                      ></app-widget-tree-node>
                    </div>
                    <div *ngIf="widgetTree.length == 0">
                      <div
                        style="
                          font-size: 14px;
                          font-weight: 500;
                          color: #2e2e2e;
                        "
                      >
                        No Widget Tree Available.
                      </div>
                    </div>
                  </div>
                  <!-- Paste content-->
                  <div
                    class="flex justify-start items-center mt-2 gap-1 cursor-pointer"
                    *ngIf="checkComponentAvailable()"
                    (click)="pasteThisComponent()"
                  >
                    <div style="font-size: 12px">Paste</div>
                    <img
                      src="assets/content_paste.svg"
                      style="width: 16px; height: auto"
                    />
                  </div>
                </div>
              </div>
              <!-- Elements's Property -->
              <div
                *ngIf="this.activeItem?.id != null"
                class="ml-2 mt-2"
                style="font-size: 16px; font-weight: 400; color: #2e2e2e"
              >
                Element-
                {{ this.activeItem?.name | capitalize }}
              </div>
              <div *ngIf="this.activeItem?.id != null" class="p-3">
                <div class="min-h-[24rem]">
                  <div
                    *ngIf="
                      this.activeItem.name == 'heading' ||
                      this.activeItem.name == 'button' ||
                      this.activeItem.name == 'input' ||
                      this.activeItem.name == 'textarea' ||
                      this.activeItem.name == 'dropdown' ||
                      this.activeItem.name == 'checkbox' ||
                      this.activeItem.name == 'radio' ||
                      this.activeItem.name == 'switch' ||
                      this.activeItem.name == 'table' ||
                      this.activeItem.name == 'image' ||
                      this.activeItem.name == 'divider' ||
                      this.activeItem.name == 'video'
                    "
                  >
                    <app-properties
                      [fields]="fields"
                      [props]="activeItem"
                      [collections]="collections"
                      (deleteProp)="deleteActiveItem($event)"
                      [ImageURL]="this.imageURL"
                      (assetModelOpen)="checkImageModelClicked($event)"
                    ></app-properties>
                  </div>
                  <div
                    *ngIf="
                      this.activeItem.name == 'form' ||
                      this.activeItem.name == 'grid' ||
                      this.activeItem.name == 'container' ||
                      this.activeItem.name == 'row' ||
                      this.activeItem.name == 'column' ||
                      this.activeItem.name == 'card'
                    "
                  >
                    <app-properties2
                      [fields]="fields"
                      [props]="activeItem"
                      [collections]="collections"
                      (deleteProp)="deleteActiveItem($event)"
                    ></app-properties2>
                  </div>

                  <div class="text-center m-8" *ngIf="!activeItem">
                    Drag and drop from blocks to center panel to create form.
                  </div>
                </div>
                <div class="mt-4">
                  <div class="bg-gray-50 border-b p-2 font-semibold">
                    Form Properties
                  </div>
                  <div class="">
                    <!-- <vezo-switch label="Has Workflow"></vezo-switch> -->
                    <vezo-select label="Process"></vezo-select>
                    <div class="text-right mb-8">
                      <vezo-button
                        label="Save"
                        className="bg-gray-50 w-6 h-6"
                        (click)="saveDefinition()"
                      ></vezo-button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- <div *ngIf="!this.rightPanelExpanded">
            <div
              style="
                height: 47px;
                width: 32px;
                border-bottom-left-radius: 4px;
                align-items: center;
              "
              class="border-b border-l border-r flex justify-center px-2 shadow-md bg-white"
              (click)="this.rightPanelExpanded = !this.rightPanelExpanded"
            >
              <vezo-icon
                [icon]="'chevronLeft'"
                className="cursor-pointer w-5 h-5"
                style="color: black"
              ></vezo-icon>
            </div>
          </div> -->
        </div>
      </div>
      <div class="flex justify-start">
        <div
          *ngIf="this.formId == null"
          style="height: 100vh; width: 85%"
          class="flex justify-center items-center"
        >
          <div
            *ngIf="this.data.length > 0"
            style="font-size: 16px; font-weight: 500"
          >
            Please Select the Component
          </div>
          <div
            *ngIf="this.data.length <= 0"
            style="font-size: 16px; font-weight: 500"
          >
            No Component Found, Add One!
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Code for Adding/ Editing a active Component -->
<vezo-modal [(visible)]="visible">
  <ng-template vTemplate="header">Component Details</ng-template>
  <ng-template vTemplate="content">
    <form [formGroup]="form">
      <!-- <vezo-select optionLabel="applicationName" [items]="applicationItems" formControlName="application"
                label="Application"></vezo-select> -->
      <vezo-select
        optionLabel="microServiceName"
        [items]="microserviceItems"
        formControlName="microService"
        label="Microservice"
        (ngModelChange)="getCollectionItems()"
      ></vezo-select>
      <vezo-select
        optionLabel="collectionName"
        [items]="collectionItems"
        formControlName="collection"
        label="Collection"
      ></vezo-select>
      <vezo-input label="Form Name" formControlName="formName"></vezo-input>
      <error-message [controlName]="form.controls['formName']"></error-message>
    </form>
  </ng-template>
  <ng-template vTemplate="footer">
    <div class="text-right">
      <vezo-button
        label="Save"
        [disabled]="!form.valid"
        (click)="saveDataByApplication(this.currentApplication.id)"
      ></vezo-button>
    </div>
  </ng-template>
</vezo-modal>

<!-- Code for re-confirmation of delete the Component -->
<vezo-modal [(visible)]="visibleDeleteConfirmation">
  <ng-template vTemplate="header"
    >Are you sure, you want to delete this Component ?</ng-template
  >
  <ng-template vTemplate="footer">
    <div class="w-full flex justify-end gap-4 items-center">
      <vezo-button
        label="No"
        (click)="
          this.visibleDeleteConfirmation = !this.visibleDeleteConfirmation
        "
      ></vezo-button>

      <vezo-button label="Yes" (click)="deleteConfirmed()"></vezo-button>
    </div>
  </ng-template>
</vezo-modal>

<!-- Code for Choosing Image from Media Manager -->
<vezo-modal [(visible)]="this.selectAssetModel">
  <ng-template vTemplate="header">
    <div class="flex justify-between items-center">
      <div
        class="flex justify-start items-center gap-2"
        style="
          background-color: #ffffff;
          border-width: 1px;
          border-color: #e9e9fb;
          height: 32px;
          width: auto;
          border-radius: 4px;
        "
      >
        <img
          src="assets/image_search.png"
          class="ml-1"
          style="width: 24px; height: 24px"
        />
        <input
          type="text"
          placeholder="Search..."
          [(ngModel)]="searchQuery"
          (input)="searchAssets()"
          class="mr-2"
          style="border: none !important; height: 25px !important; width: auto"
        />
      </div>
    </div>
  </ng-template>
  <ng-template vTemplate="content">
    <!-- Code for the Grid View Assets -->
    <div style="height: 400px; overflow-y: scroll">
      <div
        class="flex flex-wrap gap-4 p-5"
        style="justify-items: start; background-color: #eef2ff"
      >
        <div *ngFor="let asset of getAssetList(); let i = index">
          <div
            style="
              background-color: #ffffff;
              width: 100px;
              height: 160px;
              border-radius: 8px;
            "
            class="p-3"
          >
            <div
              class="flex justify-center items-center p-4"
              style="
                width: auto;
                height: 80px;
                border-radius: 8px;
                border-width: 1px;
                border-color: #000000;
              "
            >
              <img
                [src]="asset.url"
                style="width: 70px; height: auto"
                alt="Image"
              />
            </div>
            <div
              class="flex justify-between items-center mt-2"
              style="flex-wrap: wrap-reverse"
            >
              <div style="display: flex; flex-direction: column" class="gap-1">
                <div class="flex justify-between items-center gap-2 w-auto">
                  <div
                    class="file-name"
                    style="font-size: 12px; font-weight: 500; color: #4f46e5"
                  >
                    {{
                      asset.fileName
                    }}
                  </div>
                </div>
                <div
                  class="flex justify-center items-center mt-2 cursor-pointer"
                >
                  <div
                    class="w-full text-center flex justify-center items-center"
                    (click)="sendThisAsset(asset)"
                    style="
                      height: 24px;
                      background-color: #c7222a;
                      border-radius: 6px;
                      color: #ffffff;
                      font-size: 12px;
                      font-weight: 500;
                    "
                  >
                    Select
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          *ngIf="this.getAssetList().length <= 0"
          class="flex justify-center items-center w-full"
          style="flex-direction: column; height: 90%"
        >
          <div class="text-center">
            <p style="font-size: 16px; font-weight: 500; color: #888888">
              No Asset Found!
            </p>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
  <!-- <ng-template vTemplate="footer">
        <div class="text-right">
            <vezo-button label="Save" [disabled]="!form.valid" (click)="saveData()"></vezo-button>
        </div>
    </ng-template> -->
</vezo-modal>

<!-- Toast Message and Loading Code -->
<vezo-toast></vezo-toast>
<ngx-loading
  [show]="loading"
  [config]="{ backdropBorderRadius: '3px' }"
></ngx-loading>
